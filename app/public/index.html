<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Infra-Demo FCM Test</title>
  <script type="module">
    console.log('ğŸŸ¢ script loaded');

    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-messaging.js";

    const firebaseConfig = { /* ...your config... */ };
    const PUBLIC_VAPID_KEY = "BPQTljeOPuraI-aAAJAtyYXrjQ1ktiUez_HauP_WozOInBWSzb9VaF5-CaFgaPRUaGFWtRlnfXrZU65UqBtvZ_M";

    console.log('ğŸŸ¢ initializing Firebase app');
    const app = initializeApp(firebaseConfig);
    const messaging = getMessaging(app);

    async function initFcm() {
      console.log('ğŸŸ¢ initFcm start');
      try {
        console.log('ğŸŸ¢ registering service worker');
        const registration = await navigator.serviceWorker.register('/firebase-messaging-sw.js');
        console.log('ğŸŸ¢ SW registered:', registration);

        console.log('ğŸŸ¢ requesting notification permission');
        const permission = await Notification.requestPermission();
        console.log('ğŸŸ¢ permission:', permission);
        if (permission !== 'granted') throw new Error('ê¶Œí•œ ê±°ë¶€ë¨');

        console.log('ğŸŸ¢ calling getToken()');
        const token = await getToken(messaging, {
          vapidKey: PUBLIC_VAPID_KEY,
          serviceWorkerRegistration: registration
        });
        console.log('âœ… FCM ë“±ë¡ í† í°:', token);

        onMessage(messaging, payload => {
          console.log('ğŸ“© í¬ê·¸ë¼ìš´ë“œ ë©”ì‹œì§€:', payload);
          alert(`${payload.notification.title}\n${payload.notification.body}`);
        });
      } catch (err) {
        console.error('âš ï¸ initFcm error:', err);
      }
    }

    window.addEventListener('load', () => {
      console.log('ğŸŸ¢ window loaded');
      initFcm();
    });
  </script>
</head>
<body>
  <h1>Infra-Demo FCM Client Test</h1>
  <p>ì½˜ì†” ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
</body>
</html>
